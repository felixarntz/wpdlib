/*!
 * WPDLib (https://github.com/felixarntz/wpdlib/)
 * By Felix Arntz (https://leaves-and-love.net)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
!function(e){"undefined"==typeof _wpdlib_data&&console.error("WPDLib data object not found");var t={args:_wpdlib_data,select2_enabled:"undefined"!=typeof e.fn.select2,select2_args:{},datetimepicker_enabled:"undefined"!=typeof e.fn.datetimepicker,datetimepicker_args:{},colorpicker_enabled:"undefined"!=typeof e.fn.wpColorPicker,colorpicker_args:{},mediapicker_enabled:"undefined"!=typeof e.fn.wpMediaPicker,mediapicker_args:{},mappicker_enabled:"undefined"!=typeof e.fn.wpMapPicker,mappicker_args:{},init:function(){var i=t;i.select2_args={width:"element",closeOnSelect:!0,templateResult:i._formatSelect2,templateSelection:i._formatSelect2,minimumResultsForSearch:8},i.datetimepicker_args={formatDate:"Y-m-d",formatTime:"H:i",dayOfWeekStart:i.args.start_of_week},i.colorpicker_args={mode:"hsv"},i.mediapicker_args={filterable:!1,label_add:i.args.media_i18n_add,label_replace:i.args.media_i18n_replace,label_remove:i.args.media_i18n_remove,label_modal:i.args.media_i18n_modal,label_button:i.args.media_i18n_button},i.mappicker_args={},this.datetimepicker_enabled&&e.datetimepicker.setLocale(i.args.language),i._initJQueryPluginFields(),i._setupRange(".wpdlib-input-range"),i._setupRadio(".wpdlib-input-radio"),i._setupMultibox(".wpdlib-input-multibox"),i._setupRepeatable(".wpdlib-input-repeatable")},_initJQueryPluginFields:function(e){var i=t;"string"!=typeof e?e="":e+=" ",i._setupSelect2(e+".wpdlib-input-select"),i._setupSelect2(e+".wpdlib-input-multiselect"),i._setupDatetimepicker(e+".wpdlib-input-datetime"),i._setupDatepicker(e+".wpdlib-input-date"),i._setupTimepicker(e+".wpdlib-input-time"),i._setupColorpicker(e+".wpdlib-input-color"),i._setupMediapicker(e+".wpdlib-input-media"),i._setupMappicker(e+".wpdlib-input-map")},_setupSelect2:function(e){if(this.select2_enabled){var t=this._getJQuery(e);t.select2(this.select2_args)}},_setupDatetimepicker:function(t){if(this.datetimepicker_enabled){var i=this._getJQuery(t);i.datetimepicker(e.extend({format:this.args.date_format+" "+this.args.time_format,onShow:this._datetimeOnShow},this.datetimepicker_args))}},_setupDatepicker:function(t){if(this.datetimepicker_enabled){var i=this._getJQuery(t);i.datetimepicker(e.extend({format:this.args.date_format,timepicker:!1,onShow:this._dateOnShow},this.datetimepicker_args))}},_setupTimepicker:function(t){if(this.datetimepicker_enabled){var i=this._getJQuery(t);i.datetimepicker(e.extend({format:this.args.time_format,datepicker:!1,onShow:this._timeOnShow},this.datetimepicker_args))}},_setupColorpicker:function(e){if(this.colorpicker_enabled){var t=this._getJQuery(e);t.wpColorPicker(this.colorpicker_args)}},_setupMediapicker:function(e){if(this.mediapicker_enabled){var t=this._getJQuery(e);t.wpMediaPicker(this.mediapicker_args)}},_setupMappicker:function(e){if(this.mappicker_enabled){var t=this._getJQuery(e);t.wpMapPicker(this.mappicker_args)}},_setupRange:function(t){e(document).on("change",t,function(){e(this).prev("input").val(e(this).val())}),e(document).on("change",t+"-viewer",function(){e(this).next("input").val(e(this).val())})},_setupRadio:function(t){e(document).on("click",t+" .wpdlib-radio div",function(){var t=e(this).attr("id").replace("-asset","");e("#"+t).prop("checked",!0).trigger("change")}),e(document).on("change",t+" .wpdlib-radio input",function(){var t=e(this).attr("id");e(this).parent().parent().find(".wpdlib-radio div").removeClass("checked"),e("#"+t).addClass("checked")})},_setupMultibox:function(t){e(document).on("click",t+" .wpdlib-checkbox div",function(){var t=e(this).attr("id").replace("-asset","");e(this).hasClass("checked")?(e(this).removeClass("checked"),e("#"+t).prop("checked",!1)):(e(this).addClass("checked"),e("#"+t).prop("checked",!0))})},_setupRepeatable:function(i){var a=t,r=this._getJQuery(i);r.each(function(){e(this).on("click",".wpdlib-new-repeatable-button",function(t){var i="#"+t.delegateTarget.id,r=e(i),n=parseInt(r.data("limit")),p=r.attr("id"),d=r.find(".wpdlib-repeatable-row").length;if("undefined"!=typeof a.args.repeatable_field_templates[p]){var s=a.args.repeatable_field_templates[p].replace(/{{KEY}}/g,d).replace(/{{KEY_PLUSONE}}/g,d+1);r.find(".wpdlib-repeatable-table").show(),r.find(".wpdlib-repeatable-table").append(s),n>0&&n===d+1&&r.find(".wpdlib-new-repeatable-button").hide(),e(document).trigger("wpdlib-added-repeatable-item",[i])}t.preventDefault()}),e(this).on("click",".wpdlib-remove-repeatable-button",function(t){var i=e("#"+t.delegateTarget.id),a=i.find(".wpdlib-repeatable-row"),r=parseInt(e(this).data("number"))+1;t.preventDefault(),a.filter(":nth-child("+(r+1)+")").remove(),a.filter(":gt("+(r-1)+")").each(function(){var t=e(this),i=parseInt(t.find(".wpdlib-remove-repeatable-button").data("number")),a=i-1;t.find("span:first").html(t.find("span:first").html().replace((i+1).toString(),(a+1).toString())),t.find(".wpdlib-repeatable-col input, .wpdlib-repeatable-col select, .wpdlib-repeatable-col img, .wpdlib-repeatable-col a").each(function(){e(this).attr("id")&&e(this).attr("id",e(this).attr("id").replace(i.toString(),a.toString())),e(this).attr("name")&&e(this).attr("name",e(this).attr("name").replace(i.toString(),a.toString()))}),t.find(".wpdlib-remove-repeatable-button").data("number",a.toString())});var n=parseInt(i.data("limit"));n>0&&n>i.find(".wpdlib-repeatable-row").length&&i.find(".wpdlib-new-repeatable-button").show(),i.find(".wpdlib-repeatable-row").length<1&&i.find(".wpdlib-repeatable-table").hide()})}),e(document).on("wpdlib-added-repeatable-item",function(e,t){a._initJQueryPluginFields(t)})},_getJQuery:function(t){return"string"==typeof t?e(t):t},_formatSelect2:function(t){if("undefined"==typeof t.id)return t.text;var i=e(t.element);return i.data().hasOwnProperty("image")?e('<div class="wpdlib-option-box-wrap"><div class="wpdlib-option-box" style="background-image:url('+i.data("image")+');"></div><span class="wpdlib-option-box-text">'+t.text+"</span></div>"):i.data().hasOwnProperty("color")?e('<div class="wpdlib-option-box-wrap"><div class="wpdlib-option-box" style="background-color:#'+i.data("color")+';"></div><span class="wpdlib-option-box-text">'+t.text+"</span></div>"):t.text},_datetimeOnShow:function(e,t){var i="";t.attr("min")&&(i=t.attr("min").split(" "),2===i.length?this.setOptions({minDate:i[0],minTime:i[1]}):1===i.length&&this.setOptions({minDate:i[0]})),t.attr("max")&&(i=t.attr("max").split(" "),2===i.length?this.setOptions({maxDate:i[0],maxTime:i[1]}):1===i.length&&this.setOptions({maxDate:i[0]})),t.attr("step")&&this.setOptions({step:parseInt(t.attr("step"))})},_dateOnShow:function(e,t){t.attr("min")&&this.setOptions({minDate:t.attr("min")}),t.attr("max")&&this.setOptions({maxDate:t.attr("max")})},_timeOnShow:function(e,t){t.attr("min")&&this.setOptions({minTime:t.attr("min")}),t.attr("max")&&this.setOptions({maxTime:t.attr("max")}),t.attr("step")&&this.setOptions({step:parseInt(t.attr("step"))})}};e(document).ready(function(){t.init()})}(jQuery);