/*!
 * WP Media Picker -  version 0.1.0
 * 
 * Felix Arntz <felix-arntz@leaves-and-love.net>
 */
!function(a,b){if("undefined"==typeof a.fn.wpMediaPicker){if("undefined"==typeof b||"undefined"==typeof b.media)return void(a.fn.wpMediaPicker=function(){return this});var c=b.media.editor.send.attachment,d=window.send_to_editor,e=function(a){var b=window.wpActiveEditor;document.getElementById(b).innerHTML=a,window.send_to_editor=d},f=function(a){var b="";if("image"===a.type){var c=a.url;a.sizes&&a.sizes.large?c=a.sizes.large.url:a.sizes&&a.sizes.full&&(c=a.sizes.full.url),b+='<img src="'+c+'" alt="'+a.alt+'" />'}else if("video"===a.type){var d="";a.image&&a.image.src!==a.icon&&(d=a.image.src),b+='<video class="wp-video-shortcode" preload="metadata"'+(d?' poster="'+d+'"':"")+' controls><source type="'+a.mime+'" src="'+a.url+'" /></video>'}else"audio"===a.type?(b+=a.image&&a.image.src&&a.image.src!==a.icon?'<img class="wp-audio-cover" src="'+a.image.src+'" alt="'+a.filename+'" />':'<div class="mime-type-icon"><img src="'+a.icon+'" /><span>'+a.filename+"</span></div>",b+='<audio class="wp-audio-shortcode" width="100%" preload="none" controls><source type="'+a.mime+'" src="'+a.url+'" /></audio>'):b+='<div class="mime-type-icon"><img src="'+a.icon+'" /><span>'+a.filename+"</span></div>";return b},g=function(a,b,c){var d=a.attr("id"),e=c?b.label_replace:b.label_add,f=b.label_remove;c||(c=""),a.hide().after('<a data-input-id="'+d+'" class="wp-mediapicker-button button" href="#">'+e+"</a>",'<a data-input-id="'+d+'" class="wp-mediapicker-remove-button" href="#"'+(c?"":' style="display:none;"')+">"+f+"</a>",'<div class="wp-mediapicker-content-wrap"><div id="wp-mediapicker-content-'+d+'" class="wp-mediapicker-content"'+(c?"":' style="display:none;"')+">"+(c?c:"")+"</div></div>").next(".wp-mediapicker-button").data("settings",b)};b.media.editor.send.attachment=function(d,g){var h;if(h=b.media.editor.activeEditor?b.media.editor.activeEditor:window.wpActiveEditor||"",0===h.search("wp-mediapicker-content-")){var i=h,j=i.substring("wp-mediapicker-content-".length),k=b.media.editor.get(h),l=k.options.mediapicker_settings||{};switch(l.store){case"ID":case"id":a("#"+j).val(g.id);break;case"url":a("#"+j).val(g.url);break;default:a("#"+j).val(g.url)}return a('.wp-mediapicker-button[data-input-id="'+j+'"]').text(l.label_replace),a('.wp-mediapicker-remove-button[data-input-id="'+j+'"]').show(),a("#"+i).show(),window.send_to_editor=e,f(g)}return c.apply(this,[d,g])},a(document).on("click",".wp-mediapicker-button",function(c){var d=a(this),e="wp-mediapicker-content-"+d.data("input-id"),f=a(this).data("settings"),g=b.media.editor.get(e);c.preventDefault(),g||(g=b.media.editor.add(e,{frame:"select",state:"insert",states:[new b.media.controller.Library({id:"insert",title:f.label_modal,priority:20,toolbar:"select",filterable:f.filterable,library:b.media.query(f.query),multiple:!1,editable:f.editable,allowLocalEdits:f.allowLocalEdits,displaySettings:f.displaySettings,displayUserSettings:f.displayUserSettings})],button:{event:"insert",text:f.label_button},mediapicker_settings:f})),b.media.editor.open(e)}),a(document).on("click",".wp-mediapicker-remove-button",function(b){var c=a(this),d=c.data("input-id"),e=a('.wp-mediapicker-button[data-input-id="'+d+'"]').data("settings");b.preventDefault(),a("#"+d).val(null),a('.wp-mediapicker-button[data-input-id="'+d+'"]').text(e.label_add),a("#wp-mediapicker-content-"+d).hide().empty(),c.hide()}),a.fn.wpMediaPicker=function(c){return c=a.extend({store:"url",query:{},filterable:"all",searchable:!0,editable:!1,allowLocalEdits:!1,displaySettings:!1,displayUserSettings:!1,label_add:b.media.view.l10n.addMedia,label_replace:b.media.view.l10n.replace,label_remove:b.media.view.l10n.remove,label_modal:b.media.view.l10n.addMedia,label_button:b.media.view.l10n.addMedia},c||{}),this.each(function(){var d=a(this),e=a.extend({},c),h=d.data("settings");if(h){if("string"==typeof h)try{h=JSON.parse(h)}catch(i){console.error(i.message)}"object"==typeof h&&(e=a.extend(e,h))}var j=parseInt(d.val(),10);j?b.media.ajax({type:"POST",data:{action:"get-attachment",id:j},success:function(a){g(d,e,f(a))},error:function(){d.val(null),g(d,e)}}):(d.val(null),g(d,e))})}}}(jQuery,wp);